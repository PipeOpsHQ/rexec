import{p as e,C as s,s as t,m as o,D as a,l,x as c,c as i,i as r,f as n,E as v,$ as b,u as d,v as p,k as u,z as w,e as h,j as x,y as f,n as m,ai as k,t as y,R as g,G as _,A as P,q as S}from"./svelte-C2ZEhdPX.js";import{security as E,hasPasscode as L,isLocked as C}from"./security-CK_QV4pM.js";import{h as T,t as B}from"./index-BZQbtzM3.js";import"./vendor-CPGM4lnp.js";var Y=n('<p class="error-message svelte-1owbbx"> </p>'),j=n('<div class="lock-overlay svelte-1owbbx"><div class="lock-container svelte-1owbbx"><div class="lock-icon svelte-1owbbx"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="svelte-1owbbx"><rect x="3" y="11" width="18" height="11" rx="2" ry="2" class="svelte-1owbbx"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4" class="svelte-1owbbx"></path></svg></div> <h2 class="lock-title svelte-1owbbx">Session Locked</h2> <p class="lock-subtitle svelte-1owbbx">Enter your passcode to resume</p> <div class="passcode-form svelte-1owbbx"><input type="password" class="passcode-input svelte-1owbbx" placeholder="Enter passcode" name="screen-lock-passcode" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false"/> <!> <button class="btn btn-primary unlock-btn svelte-1owbbx"> </button></div> <p class="lock-hint svelte-1owbbx"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1owbbx"><circle cx="12" cy="12" r="10" class="svelte-1owbbx"></circle><path d="M12 16v-4" class="svelte-1owbbx"></path><path d="M12 8h.01" class="svelte-1owbbx"></path></svg> Your terminal sessions are still running in the background</p></div></div>'),z=n('<div class="prompt-overlay svelte-1owbbx"><div class="prompt-container svelte-1owbbx"><div class="prompt-header svelte-1owbbx"><div class="prompt-icon svelte-1owbbx"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1owbbx"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" class="svelte-1owbbx"></path></svg></div> <h3 class="svelte-1owbbx">Protect Your Session</h3> <button class="prompt-close svelte-1owbbx">×</button></div> <div class="prompt-body svelte-1owbbx"><p class="svelte-1owbbx">Set a screen lock passcode to protect your terminals when you\'re away. Your active sessions will stay running.</p> <div class="prompt-features svelte-1owbbx"><div class="feature svelte-1owbbx"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" class="svelte-1owbbx"><polyline points="20 6 9 17 4 12" class="svelte-1owbbx"></polyline></svg> <span class="svelte-1owbbx">Auto-locks after inactivity</span></div> <div class="feature svelte-1owbbx"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" class="svelte-1owbbx"><polyline points="20 6 9 17 4 12" class="svelte-1owbbx"></polyline></svg> <span class="svelte-1owbbx">Terminals keep running</span></div> <div class="feature svelte-1owbbx"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" class="svelte-1owbbx"><polyline points="20 6 9 17 4 12" class="svelte-1owbbx"></polyline></svg> <span class="svelte-1owbbx">Quick unlock with passcode</span></div></div></div> <div class="prompt-footer svelte-1owbbx"><button class="btn btn-secondary svelte-1owbbx">Maybe Later</button> <button class="btn btn-primary svelte-1owbbx">Set Passcode</button></div></div></div>'),A=n('<p class="error-message svelte-1owbbx"> </p>'),I=n('<div class="setup-overlay svelte-1owbbx"><div class="setup-container svelte-1owbbx"><div class="setup-header svelte-1owbbx"><h3 class="svelte-1owbbx">Set Screen Lock Passcode</h3> <button class="setup-close svelte-1owbbx">×</button></div> <div class="setup-body svelte-1owbbx"><div class="form-group svelte-1owbbx"><label for="new-passcode" class="svelte-1owbbx">New Passcode</label> <input type="password" class="input svelte-1owbbx" placeholder="New Passcode" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false"/></div> <div class="form-group svelte-1owbbx"><label for="confirm-passcode" class="svelte-1owbbx">Confirm Passcode</label> <input type="password" class="input svelte-1owbbx" placeholder="Confirm Passcode" autocomplete="new-password" autocorrect="off" autocapitalize="off" spellcheck="false"/></div> <!> <p class="setup-hint svelte-1owbbx">Your session will auto-lock after 5 minutes of inactivity. You can change this in Settings.</p></div> <div class="setup-footer svelte-1owbbx"><button class="btn btn-secondary svelte-1owbbx">Cancel</button> <button class="btn btn-primary svelte-1owbbx"> </button></div></div></div>'),M=n("<!> <!> <!>",1);function F(n,S){e(S,!1);const F=()=>c(C,"$isLocked",$),V=()=>c(T,"$isAuthenticated",$),[$,q]=f();let D=o(""),N=o(""),G=o(""),Q=o(!1),R=o(!1),U=o(""),W=o(!1),H=null,J=null,K=!1,O=!1,X=null,Z=null;const ee=["mousedown","mousemove","keydown","scroll","touchstart","click"];function se(){K&&(J&&clearTimeout(J),J=setTimeout(()=>{E.updateActivity()},1e3))}function te(){K&&O&&E.checkInactivity()&&E.lock()}function oe(){K&&(document.hidden||O&&E.checkInactivity()&&E.lock())}async function ae(){if(!u(D).trim())return void t(U,"Please enter your passcode");t(R,!0),t(U,"");const e=await E.unlockWithPasscode(u(D));e.success?(t(D,""),B.success("Screen unlocked")):(t(U,e.error||"Incorrect passcode"),t(D,"")),t(R,!1)}async function le(){if(!u(N).trim())return void t(U,"Please enter a passcode");if(u(N).length<4)return void t(U,"Passcode must be at least 4 characters");if(u(N)!==u(G))return void t(U,"Passcodes don't match");t(R,!0);const e=await E.setPasscode(u(N));if(t(R,!1),!e.success)return e.error&&(e.error.includes("current_passcode is required")||e.error.includes("already exists"))?(await E.refreshFromServer(),t(U,"A passcode is already set. Please reload the page."),void t(W,!1)):void t(U,e.error||"Failed to set passcode");t(N,""),t(G,""),t(Q,!1),t(W,!1),B.success("Screen lock passcode set! Your session is now protected.")}function ce(){t(W,!1),E.dismissSetupPrompt()}function ie(){t(W,!1),t(Q,!0),t(U,"")}function re(){t(Q,!1),t(N,""),t(G,""),t(U,"")}s(()=>{X=T.subscribe(e=>{K=e,e&&E.refreshFromServer()}),Z=L.subscribe(e=>{O=e}),ee.forEach(e=>{document.addEventListener(e,se,{passive:!0})}),document.addEventListener("visibilitychange",oe),H=setInterval(te,3e4),setTimeout(()=>{if(K&&!O){E.getState().passcodeSetupPromptDismissed||t(W,!0)}},3e4)}),a(()=>{X&&X(),Z&&Z(),ee.forEach(e=>{document.removeEventListener(e,se)}),document.removeEventListener("visibilitychange",oe),H&&clearInterval(H),J&&clearTimeout(J)}),l(()=>F(),()=>{F()&&(t(D,""),t(U,""))}),i(),r();var ne=M();v("keydown",b,function(e){"Enter"===e.key?F()?ae():u(Q)&&le():"Escape"===e.key&&(u(Q)?re():u(W)&&ce())});var ve=d(ne),be=e=>{var s=j(),o=m(s),a=w(m(o),6),l=m(a);k(l);var c=w(l,2),i=e=>{var s=Y(),t=m(s);y(()=>P(t,u(U))),h(e,s)};p(c,e=>{u(U)&&e(i)});var r=w(c,2);r.__click=ae;var n=m(r);y(e=>{l.disabled=u(R),r.disabled=e,P(n,u(R)?"Verifying...":"Unlock")},[()=>(u(R),u(D),_(()=>u(R)||!u(D).trim()))]),g(l,()=>u(D),e=>t(D,e)),h(e,s)};p(ve,e=>{F()&&V()&&e(be)});var de=w(ve,2),pe=e=>{var s=z();s.__click=e=>e.target===e.currentTarget&&ce();var t=m(s),o=m(t);w(m(o),4).__click=ce;var a=w(o,4),l=m(a);l.__click=ce,w(l,2).__click=ie,h(e,s)};p(de,e=>{u(W)&&V()&&!F()&&e(pe)});var ue=w(de,2),we=e=>{var s=I();s.__click=e=>e.target===e.currentTarget&&re();var o=m(s),a=m(o);w(m(a),2).__click=re;var l=w(a,2),c=m(l),i=w(m(c),2),r=w(c,2),n=w(m(r),2),v=w(r,2),b=e=>{var s=A(),t=m(s);y(()=>P(t,u(U))),h(e,s)};p(v,e=>{u(U)&&e(b)});var d=w(l,2),x=m(d);x.__click=re;var f=w(x,2);f.__click=le;var k=m(f);y(e=>{x.disabled=u(R),f.disabled=e,P(k,u(R)?"Setting up...":"Set Passcode")},[()=>(u(R),u(N),u(G),_(()=>u(R)||!u(N).trim()||!u(G).trim()))]),g(i,()=>u(N),e=>t(N,e)),g(n,()=>u(G),e=>t(G,e)),h(e,s)};p(ue,e=>{u(Q)&&V()&&!F()&&e(we)}),h(n,ne),x(),q()}S(["click"]);export{F as default};
