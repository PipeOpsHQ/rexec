import{w as t,p as e,C as s,D as a,l as i,x as l,k as d,m as n,c as r,i as c,f as o,v,z as b,n as y,t as u,e as k,j as h,y as p,s as m,J as g,r as f,u as w,q as _,A,G as C,b as L,H as M,K as U,I as $}from"./svelte-C2ZEhdPX.js";import{a as R,g as x,d as D,f as T,b as S}from"./api-562HSYvc.js";import{d as I}from"./index-BZQbtzM3.js";import{P as V}from"./PlatformIcon-DTY1EAcS.js";import"./vendor-CPGM4lnp.js";const E={users:[],containers:[],terminals:[],agents:[],isLoading:!1,error:null,ws:null,wsConnected:!1,wsReconnectAttempts:0,wsMaxReconnectAttempts:10,wsReconnectInterval:1e3};const j=function(){const{subscribe:e,update:s}=t(E);let a=null,i=null;async function l(){if(s(t=>({...t,wsConnected:!1,error:null})),"undefined"==typeof window)return;const t=localStorage.getItem("rexec_token");if(!t)return void s(t=>({...t,error:"Authentication token missing."}));const e=x("/ws/admin/events");a=I(e,t),s(t=>({...t,ws:a})),a.onopen=()=>{s(t=>({...t,wsConnected:!0,wsReconnectAttempts:0,wsReconnectInterval:E.wsReconnectInterval})),i&&(clearTimeout(i),i=null)},a.onmessage=t=>{const e=JSON.parse(t.data);s(t=>{let s=[...t.users],a=[...t.containers],i=[...t.terminals];switch(e.type){case"user_created":s=[...s,e.payload];break;case"user_updated":s=s.map(t=>t.id===e.payload.id?e.payload:t);break;case"user_deleted":s=s.filter(t=>t.id!==e.payload.id);break;case"container_created":a=[...a,e.payload];break;case"container_updated":a=a.map(t=>t.id===e.payload.id?e.payload:t);break;case"container_deleted":a=a.filter(t=>t.id!==e.payload.id);break;case"session_created":i=[...i,e.payload];break;case"session_updated":i=i.map(t=>t.id===e.payload.id?e.payload:t);break;case"session_deleted":i=i.filter(t=>t.id!==e.payload.id)}return{...t,users:s,containers:a,terminals:i}})},a.onclose=t=>{s(t=>({...t,wsConnected:!1})),1e3!==t.code&&1001!==t.code&&s(t=>{if(t.wsReconnectAttempts<t.wsMaxReconnectAttempts){const e=t.wsReconnectAttempts+1,s=2*t.wsReconnectInterval;return i=setTimeout(l,s),{...t,wsReconnectAttempts:e,wsReconnectInterval:s}}return{...t,error:"Max reconnect attempts reached."}})},a.onerror=t=>{s(t=>({...t,error:"WebSocket error"})),a?.close()}}return{subscribe:e,fetchUsers:async()=>{s(t=>({...t,isLoading:!0,error:null}));const{data:t,error:e}=await R.get("/api/admin/users");s(e?t=>({...t,isLoading:!1,error:e}):e=>({...e,users:t||[],isLoading:!1}))},fetchContainers:async()=>{s(t=>({...t,isLoading:!0,error:null}));const{data:t,error:e}=await R.get("/api/admin/containers");s(e?t=>({...t,isLoading:!1,error:e}):e=>({...e,containers:t||[],isLoading:!1}))},fetchTerminals:async()=>{s(t=>({...t,isLoading:!0,error:null}));const{data:t,error:e}=await R.get("/api/admin/terminals");s(e?t=>({...t,isLoading:!1,error:e}):e=>({...e,terminals:t||[],isLoading:!1}))},fetchAgents:async()=>{s(t=>({...t,isLoading:!0,error:null}));const{data:t,error:e}=await R.get("/api/admin/agents");s(e?t=>({...t,isLoading:!1,error:e}):e=>({...e,agents:t||[],isLoading:!1}))},deleteUser:async t=>{const{error:e}=await R.delete(`/api/admin/users/${t}`);return e?{success:!1,error:e}:{success:!0}},deleteContainer:async t=>{const{error:e}=await R.delete(`/api/admin/containers/${t}`);return e?{success:!1,error:e}:{success:!0}},startAdminEvents:()=>{l()},stopAdminEvents:()=>{a&&(a.close(1e3,"Component unmounted"),a=null),i&&(clearTimeout(i),i=null),s(t=>({...t,wsConnected:!1,ws:null}))}}}();var B=o('<span class="status-indicator error svelte-yktdib">Disconnected</span>'),H=o('<span class="status-indicator connected svelte-yktdib">Live</span>'),P=o('<div class="alert alert-error svelte-yktdib"> </div>'),z=o('<div class="loading-state svelte-yktdib"><div class="spinner svelte-yktdib"></div> <p>Loading data...</p></div>'),N=o('<span class="badge admin svelte-yktdib">Admin</span>'),O=o('<span class="badge user svelte-yktdib">User</span>'),J=o('<tr class="svelte-yktdib"><td class="svelte-yktdib"><div class="user-info svelte-yktdib"><div class="avatar svelte-yktdib"> </div> <span> </span></div></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><!></td><td class="svelte-yktdib"><span> </span></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><button class="btn-icon danger svelte-yktdib" title="Delete User"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-yktdib"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></td></tr>'),q=o('<div class="data-table-container svelte-yktdib"><table class="data-table svelte-yktdib"><thead><tr class="svelte-yktdib"><th class="svelte-yktdib">User</th><th class="svelte-yktdib">Email</th><th class="svelte-yktdib">Role</th><th class="svelte-yktdib">Tier</th><th class="svelte-yktdib">Containers</th><th class="svelte-yktdib">Created</th><th class="svelte-yktdib">Last Login</th><th class="svelte-yktdib">Actions</th></tr></thead><tbody></tbody></table></div>'),G=o('<tr class="svelte-yktdib"><td class="svelte-yktdib"><div class="user-info svelte-yktdib"><div class="avatar svelte-yktdib"> </div> <span> </span></div></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><span> </span></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><button class="btn-icon danger svelte-yktdib" title="Delete User"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-yktdib"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></td></tr>'),K=o('<div class="data-table-container svelte-yktdib"><table class="data-table svelte-yktdib"><thead><tr class="svelte-yktdib"><th class="svelte-yktdib">User</th><th class="svelte-yktdib">Email</th><th class="svelte-yktdib">Tier</th><th class="svelte-yktdib">Containers</th><th class="svelte-yktdib">Created</th><th class="svelte-yktdib">Last Login</th><th class="svelte-yktdib">Actions</th></tr></thead><tbody></tbody></table></div>'),W=o('<div class="resources-cell svelte-yktdib"><span> </span> <span>/</span> <span> </span></div>'),F=o('<tr class="svelte-yktdib"><td class="svelte-yktdib"><div class="container-name-cell svelte-yktdib"><!> <span> </span></div></td><td class="svelte-yktdib"><div class="user-cell svelte-yktdib"><span class="user-name"> </span> <span class="user-email svelte-yktdib"> </span></div></td><td class="mono svelte-yktdib"> </td><td class="svelte-yktdib"><span> </span></td><td class="svelte-yktdib"><!></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><button class="btn-icon danger svelte-yktdib" title="Delete Container"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-yktdib"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></td></tr>'),Q=o('<div class="data-table-container svelte-yktdib"><table class="data-table svelte-yktdib"><thead><tr class="svelte-yktdib"><th class="svelte-yktdib">Name</th><th class="svelte-yktdib">User</th><th class="svelte-yktdib">Image</th><th class="svelte-yktdib">Status</th><th class="svelte-yktdib">Resources</th><th class="svelte-yktdib">Created</th><th class="svelte-yktdib">Actions</th></tr></thead><tbody></tbody></table></div>'),X=o('<tr class="svelte-yktdib"><td class="mono svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><span> </span></td><td class="svelte-yktdib"> </td></tr>'),Y=o('<div class="data-table-container svelte-yktdib"><table class="data-table svelte-yktdib"><thead><tr class="svelte-yktdib"><th class="svelte-yktdib">Terminal ID</th><th class="svelte-yktdib">User</th><th class="svelte-yktdib">Container</th><th class="svelte-yktdib">Status</th><th class="svelte-yktdib">Connected At</th></tr></thead><tbody></tbody></table></div>'),Z=o('<div class="resources-cell svelte-yktdib"><span> </span> <span>/</span> <span> </span></div>'),tt=o('<tr class="svelte-yktdib"><td class="svelte-yktdib"><div class="container-name-cell svelte-yktdib"><!> <span> </span></div></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><span> </span></td><td class="mono svelte-yktdib"> </td><td class="svelte-yktdib"><!></td><td class="svelte-yktdib"> </td><td class="svelte-yktdib"><button class="btn-icon danger svelte-yktdib" title="Delete Agent (TODO)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-yktdib"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg></button></td></tr>'),et=o('<div class="data-table-container svelte-yktdib"><table class="data-table svelte-yktdib"><thead><tr class="svelte-yktdib"><th class="svelte-yktdib">Name</th><th class="svelte-yktdib">User</th><th class="svelte-yktdib">Status</th><th class="svelte-yktdib">Platform</th><th class="svelte-yktdib">Specs</th><th class="svelte-yktdib">Last Seen</th><th class="svelte-yktdib">Actions</th></tr></thead><tbody></tbody></table></div>'),st=o('<div class="tab-content"><!></div>'),at=o('<div class="dashboard svelte-yktdib"><div class="dashboard-header svelte-yktdib"><div class="dashboard-title svelte-yktdib"><h1 class="svelte-yktdib">Admin Dashboard</h1> <!></div> <div class="dashboard-actions"><!> <button class="btn btn-secondary btn-sm"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path></svg> Refresh</button></div></div> <div class="tabs svelte-yktdib"><button> </button> <button> </button> <button> </button> <button> </button> <button> </button></div> <!></div>');function it(t,o){e(o,!1);const _=()=>l(j,"$admin",R),[R,x]=p(),I=n(),E=n(),it=n(),lt=n(),dt=n(),nt=n(),rt=n(),ct=n();let ot=n("users");function vt(t){m(ot,t)}async function bt(){await Promise.all([j.fetchUsers(),j.fetchContainers(),j.fetchTerminals(),j.fetchAgents()])}async function yt(t){confirm("Are you sure you want to delete this user? This action cannot be undone.")&&await j.deleteUser(t)}s(async()=>{await bt(),j.startAdminEvents()}),a(()=>{j.stopAdminEvents()}),i(()=>_(),()=>{m(I,_().users)}),i(()=>d(I),()=>{m(E,d(I).filter(t=>!0===t.subscriptionActive))}),i(()=>_(),()=>{m(it,_().containers)}),i(()=>_(),()=>{m(lt,_().terminals)}),i(()=>_(),()=>{m(dt,_().agents)}),i(()=>_(),()=>{m(nt,_().isLoading)}),i(()=>_(),()=>{m(rt,_().wsConnected)}),i(()=>_(),()=>{m(ct,_().error)}),r(),c();var ut=at(),kt=y(ut),ht=y(kt),pt=b(y(ht),2),mt=t=>{var e=B();k(t,e)},gt=t=>{var e=H();k(t,e)};v(pt,t=>{d(rt)?t(gt,!1):t(mt)});var ft=b(ht,2),wt=y(ft),_t=t=>{var e=P(),s=y(e);u(()=>A(s,d(ct))),k(t,e)};v(wt,t=>{d(ct)&&t(_t)});var At=b(wt,2);At.__click=bt;var Ct=b(kt,2),Lt=y(Ct);let Mt;Lt.__click=()=>vt("users");var Ut=y(Lt),$t=b(Lt,2);let Rt;$t.__click=()=>vt("subscribers");var xt=y($t),Dt=b($t,2);let Tt;Dt.__click=()=>vt("containers");var St=y(Dt),It=b(Dt,2);let Vt;It.__click=()=>vt("terminals");var Et=y(It),jt=b(It,2);let Bt;jt.__click=()=>vt("agents");var Ht=y(jt),Pt=b(Ct,2),zt=t=>{var e=z();k(t,e)},Nt=t=>{var e=st(),s=y(e),a=t=>{var e=q(),s=y(e),a=b(y(s));g(a,5,()=>d(I),t=>t.id,(t,e)=>{var s=J(),a=y(s),i=y(a),l=y(i),n=y(l),r=b(l,2),c=y(r),o=b(a),h=y(o),p=b(o),m=y(p),g=t=>{var e=N();k(t,e)},f=t=>{var e=O();k(t,e)};v(m,t=>{d(e),C(()=>d(e).isAdmin)?t(g):t(f,!1)});var w=b(p),_=y(w),U=y(_),$=b(w),R=y($),x=b($),T=y(x),S=b(x),I=y(S),V=b(S);y(V).__click=()=>yt(d(e).id),u((t,s,a)=>{A(n,t),A(c,(d(e),C(()=>d(e).username))),A(h,(d(e),C(()=>d(e).email))),M(_,1,`badge tier-${d(e),C(()=>d(e).tier)??""}`,"svelte-yktdib"),A(U,(d(e),C(()=>d(e).tier))),A(R,(d(e),C(()=>d(e).containerCount))),A(T,s),A(I,a)},[()=>(d(e),C(()=>d(e).username.charAt(0).toUpperCase())),()=>(d(e),C(()=>new Date(d(e).created_at).toLocaleDateString())),()=>(d(e),L(D),C(()=>d(e).updated_at?D(d(e).updated_at):"-"))]),k(t,s)}),k(t,e)},i=t=>{var e=f(),s=w(e),a=t=>{var e=K(),s=y(e),a=b(y(s));g(a,5,()=>d(E),t=>t.id,(t,e)=>{var s=G(),a=y(s),i=y(a),l=y(i),n=y(l),r=b(l,2),c=y(r),o=b(a),v=y(o),h=b(o),p=y(h),m=y(p),g=b(h),f=y(g),w=b(g),_=y(w),U=b(w),$=y(U),R=b(U);y(R).__click=()=>yt(d(e).id),u((t,s,a)=>{A(n,t),A(c,(d(e),C(()=>d(e).username))),A(v,(d(e),C(()=>d(e).email))),M(p,1,`badge tier-${d(e),C(()=>d(e).tier)??""}`,"svelte-yktdib"),A(m,(d(e),C(()=>d(e).tier))),A(f,(d(e),C(()=>d(e).containerCount))),A(_,s),A($,a)},[()=>(d(e),C(()=>d(e).username.charAt(0).toUpperCase())),()=>(d(e),C(()=>new Date(d(e).created_at).toLocaleDateString())),()=>(d(e),L(D),C(()=>d(e).updated_at?D(d(e).updated_at):"-"))]),k(t,s)}),k(t,e)},i=t=>{var e=f(),s=w(e),a=t=>{var e=Q(),s=y(e),a=b(y(s));g(a,5,()=>d(it),t=>t.id,(t,e)=>{var s=F(),a=y(s),i=y(a),l=y(i);{let t=U(()=>(d(e),C(()=>function(t){if(!t)return"linux";const e=t.toLowerCase();return e.includes("ubuntu")?"ubuntu":e.includes("debian")?"debian":e.includes("alpine")?"alpine":"linux"}(d(e).image))));V(l,{get platform(){return d(t)},size:16})}var n=b(l,2),r=y(n),c=b(a),o=y(c),h=y(o),p=y(h),m=b(h,2),g=y(m),f=b(c),w=y(f),_=b(f),R=y(_),x=y(R),I=b(_),E=y(I),B=t=>{var s=W(),a=y(s),i=y(a),l=b(a,4),n=y(l);u((t,e)=>{A(i,t),A(n,e)},[()=>(L(T),d(e),C(()=>T(d(e).resources.memory_mb))),()=>(L(S),d(e),C(()=>S(d(e).resources.cpu_shares)))]),k(t,s)},H=t=>{var e=$("-");k(t,e)};v(E,t=>{d(e),C(()=>d(e).resources)?t(B):t(H,!1)});var P=b(I),z=y(P),N=b(P);y(N).__click=()=>async function(t){confirm("Are you sure you want to delete this container? This will stop and remove the container permanently.")&&await j.deleteContainer(t)}(d(e).id),u(t=>{A(r,(d(e),C(()=>d(e).name))),A(p,(d(e),C(()=>d(e).username))),A(g,(d(e),C(()=>d(e).userEmail))),A(w,(d(e),C(()=>d(e).image))),M(R,1,`status-badge ${d(e),C(()=>d(e).status)??""}`,"svelte-yktdib"),A(x,(d(e),C(()=>d(e).status))),A(z,t)},[()=>(L(D),d(e),C(()=>D(d(e).created_at)))]),k(t,s)}),k(t,e)},i=t=>{var e=f(),s=w(e),a=t=>{var e=Y(),s=y(e),a=b(y(s));g(a,5,()=>d(lt),t=>t.id,(t,e)=>{var s=X(),a=y(s),i=y(a),l=b(a),n=y(l),r=b(l),c=y(r),o=b(r),v=y(o),h=y(v),p=b(o),m=y(p);u(t=>{A(i,(d(e),C(()=>d(e).id))),A(n,(d(e),C(()=>d(e).username))),A(c,(d(e),C(()=>d(e).name))),M(v,1,`status-badge ${d(e),C(()=>d(e).status)??""}`,"svelte-yktdib"),A(h,(d(e),C(()=>d(e).status))),A(m,t)},[()=>(L(D),d(e),C(()=>D(d(e).connected_at)))]),k(t,s)}),k(t,e)},i=t=>{var e=f(),s=w(e),a=t=>{var e=et(),s=y(e),a=b(y(s));g(a,5,()=>d(dt),t=>t.id,(t,e)=>{var s=tt(),a=y(s),i=y(a),l=y(i);{let t=U(()=>(d(e),C(()=>d(e).distro||d(e).os)));V(l,{get platform(){return d(t)},size:16})}var n=b(l,2),r=y(n),c=b(a),o=y(c),h=b(c),p=y(h),m=y(p),g=b(h),f=y(g),w=b(g),_=y(w),R=t=>{var s=Z(),a=y(s),i=y(a),l=b(a,4),n=y(l);u(t=>{A(i,t),A(n,`${d(e),C(()=>d(e).system_info.num_cpu)??""} CPU`)},[()=>(L(T),d(e),C(()=>T(Math.round((d(e).system_info.memory.total||0)/1024/1024))))]),k(t,s)},x=t=>{var e=$("-");k(t,e)};v(_,t=>{d(e),C(()=>d(e).system_info&&d(e).system_info.memory&&d(e).system_info.num_cpu)?t(R):t(x,!1)});var S=b(w),I=y(S),E=b(S);y(E).__click=()=>yt(d(e).id),u((t,s)=>{A(r,(d(e),C(()=>d(e).name))),A(o,t),M(p,1,`status-badge ${d(e),C(()=>d(e).status)??""}`,"svelte-yktdib"),A(m,(d(e),C(()=>d(e).status))),A(f,`${d(e),C(()=>d(e).distro||d(e).os)??""}/${d(e),C(()=>d(e).arch)??""}`),A(I,s)},[()=>(d(e),C(()=>d(e).username||d(e).user_id.slice(0,8))),()=>(d(e),L(D),C(()=>d(e).last_ping?D(d(e).last_ping):"-"))]),k(t,s)}),k(t,e)};v(s,t=>{"agents"===d(ot)&&t(a)},!0),k(t,e)};v(s,t=>{"terminals"===d(ot)?t(a):t(i,!1)},!0),k(t,e)};v(s,t=>{"containers"===d(ot)?t(a):t(i,!1)},!0),k(t,e)};v(s,t=>{"subscribers"===d(ot)?t(a):t(i,!1)},!0),k(t,e)};v(s,t=>{"users"===d(ot)?t(a):t(i,!1)}),k(t,e)};v(Pt,t=>{d(nt)?t(zt):t(Nt,!1)}),u(()=>{At.disabled=d(nt),Mt=M(Lt,1,"tab-btn svelte-yktdib",null,Mt,{active:"users"===d(ot)}),A(Ut,`Users (${d(I),C(()=>d(I).length)??""})`),Rt=M($t,1,"tab-btn svelte-yktdib",null,Rt,{active:"subscribers"===d(ot)}),A(xt,`Subscribers (${d(E),C(()=>d(E).length)??""})`),Tt=M(Dt,1,"tab-btn svelte-yktdib",null,Tt,{active:"containers"===d(ot)}),A(St,`Containers (${d(it),C(()=>d(it).length)??""})`),Vt=M(It,1,"tab-btn svelte-yktdib",null,Vt,{active:"terminals"===d(ot)}),A(Et,`Active Terminals (${d(lt),C(()=>d(lt).length)??""})`),Bt=M(jt,1,"tab-btn svelte-yktdib",null,Bt,{active:"agents"===d(ot)}),A(Ht,`Agents (${d(dt),C(()=>d(dt).length)??""})`)}),k(t,ut),h(),x()}_(["click"]);export{it as default};
