import{w as r,g as t}from"./svelte-C2ZEhdPX.js";import{a as e}from"./index-BZQbtzM3.js";const n=function(){const{subscribe:n,set:i,update:o}=r({recordings:[],activeRecordings:new Map,isLoading:!1,error:null});async function s(){const r=t(e).token;if(r){o(r=>({...r,isLoading:!0,error:null}));try{const t=await fetch("/api/recordings",{headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw new Error("Failed to fetch recordings");const e=((await t.json()).recordings||[]).map(r=>({id:r.id,title:r.title,durationMs:r.duration_ms,duration:r.duration,sizeBytes:r.size_bytes,isPublic:r.is_public,shareToken:r.share_token,shareUrl:r.share_url,createdAt:r.created_at}));o(r=>({...r,recordings:e,isLoading:!1}))}catch(n){o(r=>({...r,error:n.message,isLoading:!1}))}}}return{subscribe:n,fetchRecordings:s,startRecording:async function(r,n){const i=t(e).token;if(!i)return null;try{const t=await fetch("/api/recordings/start",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({container_id:r,title:n})});if(!t.ok){const r=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(r.error||"Failed to start recording")}const e=await t.json();return o(t=>{const n=new Map(t.activeRecordings);return n.set(r,{recording:!0,recordingId:e.recording_id,startedAt:e.started_at,durationMs:0,eventsCount:0}),{...t,activeRecordings:n}}),e.recording_id}catch(s){return o(r=>({...r,error:s.message})),null}},stopRecording:async function(r){const n=t(e).token;if(!n)return null;try{const t=await fetch(`/api/recordings/stop/${r}`,{method:"POST",headers:{Authorization:`Bearer ${n}`}});if(!t.ok){const r=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(r.error||"Failed to stop recording")}const e=await t.json();return o(t=>{const e=new Map(t.activeRecordings);return e.delete(r),{...t,activeRecordings:e}}),await s(),{id:e.recording_id,title:"",durationMs:e.duration_ms,duration:e.duration,sizeBytes:e.size_bytes,isPublic:!1,shareToken:e.share_token,shareUrl:`/r/${e.share_token}`,createdAt:(new Date).toISOString()}}catch(i){return o(r=>({...r,error:i.message})),null}},getRecordingStatus:async function(r){const n=t(e).token;if(!n)return{recording:!1};try{const t=await fetch(`/api/recordings/status/${r}`,{headers:{Authorization:`Bearer ${n}`}});if(!t.ok)return{recording:!1};const e=await t.json();return e.recording&&o(t=>{const n=new Map(t.activeRecordings);return n.set(r,{recording:!0,recordingId:e.recording_id,startedAt:e.started_at,durationMs:e.duration_ms,eventsCount:e.events_count}),{...t,activeRecordings:n}}),e}catch(i){return{recording:!1}}},updateRecording:async function(r,n){const i=t(e).token;if(!i)return!1;try{if((await fetch(`/api/recordings/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({is_public:n.isPublic,title:n.title})})).ok)return await s(),!0}catch(o){}return!1},deleteRecording:async function(r){const n=t(e).token;if(!n)return!1;try{if((await fetch(`/api/recordings/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok)return o(t=>({...t,recordings:t.recordings.filter(t=>t.id!==r)})),!0}catch(i){}return!1},isRecording:function(r){const e=t({subscribe:n});return e.activeRecordings.get(r)?.recording||!1},getActiveRecording:function(r){return t({subscribe:n}).activeRecordings.get(r)},formatSize:function(r){return r<1024?`${r} B`:r<1048576?`${(r/1024).toFixed(1)} KB`:`${(r/1048576).toFixed(1)} MB`},reset:function(){i({recordings:[],activeRecordings:new Map,isLoading:!1,error:null})}}}();export{n as r};
