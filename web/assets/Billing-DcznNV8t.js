import{w as a,d as s,p as e,B as t,C as i,s as n,m as r,i as o,f as c,n as l,v,k as u,z as p,e as b,j as d,y as f,u as k,x as h,t as g,o as m,A as w,r as y,J as _,_ as S,q as F,I as j,F as P}from"./svelte-V7cO9hUs.js";import{S as E,u as L,t as U}from"./index-CRn00pAv.js";import"./vendor-CPGM4lnp.js";const C={subscription:null,invoices:[],isLoading:!1,error:null};const x=function(){const{subscribe:s,set:e,update:t}=a(C);async function i(){const a=localStorage.getItem("rexec_token");return{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}}return{subscribe:s,async fetchSubscription(){t(a=>({...a,isLoading:!0,error:null}));try{const a=await fetch("/api/billing/subscription",{headers:await i()});if(!a.ok)throw new Error("Failed to fetch subscription");const s=await a.json();return t(a=>({...a,subscription:s,isLoading:!1})),s}catch(a){const s=a instanceof Error?a.message:"Failed to fetch subscription";return t(a=>({...a,isLoading:!1,error:s})),null}},async fetchInvoices(){t(a=>({...a,isLoading:!0,error:null}));try{const a=await fetch("/api/billing/history",{headers:await i()});if(!a.ok)throw new Error("Failed to fetch billing history");const s=await a.json();return t(a=>({...a,invoices:s.invoices||[],isLoading:!1})),s.invoices}catch(a){const s=a instanceof Error?a.message:"Failed to fetch billing history";return t(a=>({...a,isLoading:!1,error:s})),[]}},async createCheckout(a){try{const s=await fetch("/api/billing/checkout",{method:"POST",headers:await i(),body:JSON.stringify({tier:a})});if(!s.ok){const a=await s.json();throw new Error(a.error||"Failed to create checkout session")}return{success:!0,checkoutUrl:(await s.json()).checkout_url}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to create checkout"}}},async openPortal(){try{const a=await fetch("/api/billing/portal",{method:"POST",headers:await i()});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to open billing portal")}return{success:!0,portalUrl:(await a.json()).portal_url}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to open portal"}}},async cancelSubscription(){try{const a=await fetch("/api/billing/cancel",{method:"POST",headers:await i()});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to cancel subscription")}return{success:!0,message:(await a.json()).message}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Failed to cancel subscription"}}},reset(){e(C)}}}();s(x,a=>a.subscription),s(x,a=>a.invoices),s(x,a=>a.isLoading);var $=c('<div class="loading svelte-ibakof"><div class="spinner svelte-ibakof"></div> <p class="svelte-ibakof">Loading billing information...</p></div>'),A=c('<span class="status-badge active svelte-ibakof">Active</span>'),I=c('<span class="status-badge past-due svelte-ibakof">Past Due</span>'),B=c('<span class="status-badge canceled svelte-ibakof">Canceled</span>'),D=c('<p class="period-info svelte-ibakof"><!></p>'),T=c('<button class="btn btn-primary svelte-ibakof">Upgrade Plan</button>'),z=c('<span class="spinner-small svelte-ibakof"></span>'),M=c('<button class="btn btn-secondary svelte-ibakof"><!></button>'),N=c('<div class="empty-state svelte-ibakof"><!> <p class="svelte-ibakof">No billing history yet</p> <span class="empty-hint svelte-ibakof">Your invoices will appear here once you subscribe to a\n                        paid plan.</span></div>'),O=c('<a target="_blank" rel="noopener noreferrer" class="action-link svelte-ibakof">View</a>'),J=c('<a target="_blank" rel="noopener noreferrer" class="action-link svelte-ibakof">PDF</a>'),q=c('<div class="table-row svelte-ibakof"><span class="col-date"> </span> <span class="col-number svelte-ibakof"> </span> <span class="col-amount"> </span> <span class="col-status svelte-ibakof"><span class="status-pill svelte-ibakof"> </span></span> <span class="col-actions svelte-ibakof"><!> <!></span></div>'),H=c('<div class="invoices-table svelte-ibakof"><div class="table-header svelte-ibakof"><span class="col-date">Date</span> <span class="col-number svelte-ibakof">Invoice</span> <span class="col-amount">Amount</span> <span class="col-status svelte-ibakof">Status</span> <span class="col-actions svelte-ibakof">Actions</span></div> <!></div>'),V=c('<span class="spinner-small svelte-ibakof"></span>'),Y=c('<button class="btn btn-secondary svelte-ibakof"><!></button>'),G=c('<section class="section svelte-ibakof"><h2 class="svelte-ibakof">Current Plan</h2> <div class="plan-card svelte-ibakof"><div class="plan-info"><div class="plan-header svelte-ibakof"><span class="tier-badge svelte-ibakof"> </span> <!></div> <!> <p class="limit-info svelte-ibakof">Container limit: <strong class="svelte-ibakof"> </strong></p></div> <div class="plan-actions svelte-ibakof"><!></div></div></section> <section class="section svelte-ibakof"><h2 class="svelte-ibakof">Billing History</h2> <!></section> <section class="section svelte-ibakof"><h2 class="svelte-ibakof">Payment Methods</h2> <div class="payment-info svelte-ibakof"><p class="svelte-ibakof">Payment methods are managed through our secure billing\n                    portal powered by Stripe.</p> <!></div></section>',1),K=c('<div class="billing-page svelte-ibakof"><div class="page-header svelte-ibakof"><button class="back-btn svelte-ibakof"><!> Back</button> <h1 class="svelte-ibakof">Billing</h1></div> <!></div>');function Q(a,s){e(s,!1);const c=()=>h(L,"$userTier",F),[F,C]=f(),Q=t();let R=r(null),W=r([]),X=r(!0),Z=r(!1);function aa(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function sa(a){switch(a){case"pro":return"#00d4ff";case"enterprise":return"#8b5cf6";default:return"var(--text-muted)"}}async function ea(){n(Z,!0);const a=await x.openPortal();n(Z,!1),a.success&&a.portalUrl?window.open(a.portalUrl,"_blank"):U.error(a.error||"Failed to open billing portal")}i(async()=>{n(X,!0);const[a]=await Promise.all([x.fetchSubscription(),x.fetchInvoices()]);n(R,a),x.subscribe(a=>{n(W,a.invoices)}),n(X,!1)}),o();var ta=K(),ia=l(ta),na=l(ia);na.__click=()=>Q("back");var ra=l(na);E(ra,{status:"back",size:16});var oa=p(ia,2),ca=a=>{var s=$();b(a,s)},la=a=>{var s=G(),e=k(s),t=p(l(e),2),i=l(t),n=l(i),r=l(n),o=l(r),d=p(r,2),f=a=>{var s=A();b(a,s)},h=a=>{var s=y(),e=k(s),t=a=>{var s=I();b(a,s)},i=a=>{var s=y(),e=k(s),t=a=>{var s=B();b(a,s)};v(e,a=>{"canceled"===u(R)?.status&&a(t)},!0),b(a,s)};v(e,a=>{"past_due"===u(R)?.status?a(t):a(i,!1)},!0),b(a,s)};v(d,a=>{"active"===u(R)?.status?a(f):a(h,!1)});var F=p(n,2),L=a=>{var s=D(),e=l(s),t=a=>{var s=j();g(a=>w(s,`Access until ${a??""}`),[()=>aa(u(R).current_period_end)]),b(a,s)},i=a=>{var s=j();g(a=>w(s,`Next billing date: ${a??""}`),[()=>aa(u(R).current_period_end)]),b(a,s)};v(e,a=>{"canceled"===u(R).status?a(t):a(i,!1)}),b(a,s)};v(F,a=>{u(R)?.current_period_end&&a(L)});var U=p(F,2),C=p(l(U)),x=l(C),$=p(i,2),K=l($),X=a=>{var s=T();s.__click=()=>Q("pricing"),b(a,s)},ta=a=>{var s=M();s.__click=ea;var e=l(s),t=a=>{var s=z();b(a,s)},i=a=>{var s=j("Manage Subscription");b(a,s)};v(e,a=>{u(Z)?a(t):a(i,!1)}),g(()=>s.disabled=u(Z)),b(a,s)};v(K,a=>{"free"===c()||"guest"===c()?a(X):a(ta,!1)});var ia=p(e,2),na=p(l(ia),2),ra=a=>{var s=N(),e=l(s);E(e,{status:"invoice",size:48}),b(a,s)},oa=a=>{var s=H(),e=p(l(s),2);_(e,1,()=>u(W),S,(a,s)=>{var e=q(),t=l(e),i=l(t),n=p(t,2),r=l(n),o=p(n,2),c=l(o),d=p(o,2),f=l(d),k=l(f),h=p(d,2),y=l(h),_=a=>{var e=O();g(()=>P(e,"href",u(s).hosted_invoice_url)),b(a,e)};v(y,a=>{u(s).hosted_invoice_url&&a(_)});var S=p(y,2),F=a=>{var e=J();g(()=>P(e,"href",u(s).invoice_pdf)),b(a,e)};v(S,a=>{u(s).invoice_pdf&&a(F)}),g((a,e,t)=>{w(i,a),w(r,u(s).number||"â€”"),w(c,e),m(f,`color: ${t??""}`),w(k,u(s).status)},[()=>aa(u(s).created),()=>{return a=u(s).amount_paid||u(s).amount_due,e=u(s).currency,new Intl.NumberFormat("en-US",{style:"currency",currency:e.toUpperCase()}).format(a/100);var a,e},()=>function(a){switch(a){case"paid":return"var(--accent)";case"open":case"draft":return"var(--warning)";case"void":case"uncollectible":return"var(--error)";default:return"var(--text-muted)"}}(u(s).status)]),b(a,e)}),b(a,s)};v(na,a=>{0===u(W).length?a(ra):a(oa,!1)});var ca=p(ia,2),la=p(l(ca),2),va=p(l(la),2),ua=a=>{var s=Y();s.__click=ea;var e=l(s),t=a=>{var s=V();b(a,s)},i=a=>{var s=j("Manage Payment Methods");b(a,s)};v(e,a=>{u(Z)?a(t):a(i,!1)}),g(()=>s.disabled=u(Z)),b(a,s)};v(va,a=>{"free"!==c()&&"guest"!==c()&&a(ua)}),g((a,s,e)=>{m(r,`background: ${a??""}20; color: ${s??""}`),w(o,e),w(x,u(R)?.container_limit||5)},[()=>sa(c()||"free"),()=>sa(c()||"free"),()=>(c()||"free").toUpperCase()]),b(a,s)};v(oa,a=>{u(X)?a(ca):a(la,!1)}),b(a,ta),d(),C()}F(["click"]);export{Q as default};
